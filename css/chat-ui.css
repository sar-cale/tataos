.chat-header{height:50px;border-bottom:1px solid rgba(0,0,0,0.05);display:flex;align-items:center;padding:0 15px;background:rgba(255,255,255,0.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);z-index:10;position:relative;}
.avatar{width:36px;height:36px;border-radius:50%;background:#ddd;margin-right:10px;}
.chat-info h3{font-size:16px;font-weight:600;margin:0;}
.chat-info span{font-size:12px;color:#888;}
.message-list{flex:1;overflow-y:auto;padding:15px;display:flex;flex-direction:column;gap:15px;}
.msg-row{display:flex;width:100%;align-items:flex-end;gap:8px;position:relative;}
.msg-row.me{justify-content:flex-end;}
.msg-row.ai{justify-content:flex-start;}
.msg-avatar{width:36px;height:36px;border-radius:50%;background-color:#ddd;background-size:cover;background-position:center;border:2px solid rgba(255,255,255,0.5);box-shadow:0 2px 5px rgba(0,0,0,0.1);flex-shrink:0;}
.bubble{max-width:75%;padding:12px 16px;border-radius:20px;font-size:15px;line-height:1.5;word-wrap:break-word;white-space:pre-wrap;box-shadow:0 4px 12px rgba(0,0,0,0.05);position:relative;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);}
.msg-row.me .bubble{background-color:rgba(40,40,40,0.75);color:#fff;border:1px solid rgba(255,255,255,0.1);border-bottom-right-radius:4px;}
.msg-row.ai .bubble{background-color:rgba(255,255,255,0.7);color:#333;border:1px solid rgba(255,255,255,0.6);border-bottom-left-radius:4px;}
.msg-row.ai .bubble.thought{background-color:#f0f0f0;color:#666;font-style:italic;border:1px dashed #ccc;font-size:13px;}
.input-area{padding:10px 15px 25px 15px;background-color:rgba(255,255,255,0.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);display:flex;align-items:center;gap:10px;border-top:1px solid rgba(0,0,0,0.05);box-sizing:border-box;width:100%;position:relative;}
.input-area>i{flex-shrink:0;font-size:28px;color:#888;cursor:pointer;transition:transform 0.2s cubic-bezier(0.175,0.885,0.32,1.275);}
.input-area>i.active{transform:rotate(45deg);color:#333;}
.input-box{flex:1;min-width:0;padding:10px 16px;border-radius:22px;border:1px solid rgba(0,0,0,0.1);background:#fff;outline:none;font-size:15px;color:#333;height:42px;}
.btn-group{display:flex;align-items:center;gap:8px;flex-shrink:0;}
.send-btn{width:38px;height:38px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:transform 0.1s,opacity 0.2s;font-size:18px;color:white!important;}
.send-btn:active{transform:scale(0.92);}
.send-btn:disabled{background-color:#ccc!important;box-shadow:none;cursor:not-allowed;opacity:0.6;}
.btn-group .send-btn:first-child{background-color:#333;box-shadow:0 4px 10px rgba(0,0,0,0.2);}
.btn-group .send-btn:last-child{background-color:#007aff;box-shadow:0 4px 10px rgba(0,122,255,0.3);}
.plus-menu{position:absolute;bottom:80px;left:15px;width:260px;background:rgba(255,255,255,0.9);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border-radius:20px;padding:12px;box-shadow:0 10px 40px rgba(0,0,0,0.15);display:grid;grid-template-columns:repeat(4,1fr);gap:10px;z-index:50;animation:popUp 0.2s cubic-bezier(0.175,0.885,0.32,1.275);border:1px solid rgba(255,255,255,0.5);}
@keyframes popUp{from{opacity:0;transform:scale(0.9) translateY(10px);}to{opacity:1;transform:scale(1) translateY(0);}}
.plus-item{display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer;padding:5px 0;border-radius:12px;transition:background 0.2s;}
.plus-item:active{background:rgba(0,0,0,0.05);}
.plus-icon{width:44px;height:44px;border-radius:14px;background:#f2f4f6;display:flex;align-items:center;justify-content:center;font-size:22px;color:#555;}
.plus-label{font-size:11px;color:#666;font-weight:500;}
.context-menu-overlay{position:fixed;top:0;left:0;right:0;bottom:0;z-index:9999;}
.context-menu{position:absolute;background:rgba(255,255,255,0.9);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid rgba(255,255,255,0.6);border-radius:16px;padding:6px;box-shadow:0 10px 40px rgba(0,0,0,0.2);min-width:140px;display:flex;flex-direction:column;gap:2px;transform-origin:top left;animation:menuScale 0.15s ease-out;}
@keyframes menuScale{from{opacity:0;transform:scale(0.95);}to{opacity:1;transform:scale(1);}}
.menu-item{padding:12px 16px;display:flex;align-items:center;gap:12px;font-size:14px;font-weight:500;color:#333;border-radius:12px;cursor:pointer;transition:background 0.2s;}
.menu-item:active{background:rgba(0,0,0,0.08);}
.menu-item.danger{color:#ff3b30;}
.menu-item i{font-size:18px;opacity:0.7;}
.os-modal{position:absolute;top:60px;right:20px;width:280px;height:300px;background:rgba(255,255,255,0.75);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid rgba(255,255,255,0.4);box-shadow:0 20px 60px rgba(0,0,0,0.15);border-radius:24px;z-index:100;display:flex;flex-direction:column;overflow:hidden;animation:slideInDown 0.3s cubic-bezier(0.175,0.885,0.32,1.275);}
@keyframes slideInDown{from{opacity:0;transform:translateY(-20px);}to{opacity:1;transform:translateY(0);}}
.os-header{padding:15px;border-bottom:1px solid rgba(0,0,0,0.05);font-size:14px;font-weight:600;color:#555;display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.3);}
.os-content{flex:1;padding:15px;overflow-y:auto;font-size:13px;line-height:1.6;color:#444;font-family:sans-serif;white-space:pre-wrap;}
.os-placeholder{color:#999;font-style:italic;text-align:center;margin-top:50px;}
.thinking-dot{display:inline-block;width:6px;height:6px;background:#333;border-radius:50%;margin-right:4px;animation:bounce 1s infinite;}
@keyframes bounce{0%,100%{transform:translateY(0);}50%{transform:translateY(-4px);}}
.msg-row.selecting{opacity:0.5;pointer-events:none;}
.msg-row.selected{opacity:1;background:rgba(0,122,255,0.08);border-radius:16px;padding:5px;margin:-5px 0;}
.checkbox-overlay{margin-right:10px;display:flex;align-items:center;color:#007aff;font-size:24px;animation:fadeIn 0.2s;}
.chat-room-container{position:relative;height:100%;width:100%;overflow:hidden;display:flex;flex-direction:column;}
.chat-abs-header{position:absolute;top:0;left:0;right:0;height:50px;z-index:10;}
.chat-abs-list{position:absolute;top:50px;bottom:80px;left:0;right:0;overflow-y:auto;-webkit-overflow-scrolling:touch;}
.chat-abs-footer{position:absolute;bottom:0;left:0;right:0;z-index:20;}
.css-preview-box{width:100%;min-height:120px;padding:20px;border-radius:16px;border:1px solid rgba(0,0,0,0.1);margin-bottom:15px;display:flex;flex-direction:column;gap:15px;background-color:#f9f9f9;background-size:cover;background-position:center;}
.remove-bg-btn{margin-top:10px;color:#ff3b30;text-align:center;font-size:13px;font-weight:600;cursor:pointer;padding:10px;border-radius:12px;background:rgba(255,59,48,0.1);border:1px solid rgba(255,59,48,0.2);display:flex;align-items:center;justify-content:center;gap:6px;transition:all 0.2s;}
.remove-bg-btn:active{background:rgba(255,59,48,0.2);transform:scale(0.98);}
.quote-banner{background:#f7f7f7;padding:10px 15px;font-size:12px;color:#666;display:flex;justify-content:space-between;align-items:center;border-top:1px solid rgba(0,0,0,0.05);animation:slideUpFade 0.2s ease-out;}
.quote-content{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-right:10px;border-left:3px solid #ccc;padding-left:8px;}
.quote-close{font-size:18px;color:#999;cursor:pointer;flex-shrink:0;}
@keyframes slideUpFade{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
/* 引用块：放在气泡底部 */
.bubble-quote {
    padding: 8px 10px;
    margin-top: 8px; /* 关键：与上方正文拉开距离 */
    border-radius: 8px;
    font-size: 12px;
    line-height: 1.4;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: block;
    max-width: 100%;
    position: relative;
}

/* AI 引用样式 */
.msg-row.ai .bubble-quote {
    background: rgba(0, 0, 0, 0.05);
    color: #888;
    border-left: 2px solid #ccc;
}

/* User 引用样式 */
.msg-row.me .bubble-quote {
    background: rgba(0, 0, 0, 0.2);
    color: rgba(255, 255, 255, 0.8);
    border-left: 2px solid rgba(255, 255, 255, 0.5);
}

/* --- 垂直布局容器 --- */
.msg-col {
    display: flex;
    flex-direction: column; /* 垂直排列 */
    max-width: 75%; /* 宽度限制移到这里 */
}

/* 对齐方式 */
.msg-row.me .msg-col { align-items: flex-end; } /* 我发的消息：靠右对齐 */
.msg-row.ai .msg-col { align-items: flex-start; } /* AI发的消息：靠左对齐 */

/* 修正 bubble 宽度 */
.bubble {
    max-width: 100%; /* 占满 msg-col 的宽度 */
    width: fit-content; /* 内容少时收缩 */
}

/* --- 独立引用气泡 (仿微信) --- */
.quote-bubble {
    margin-top: 4px; /* 和上面的气泡拉开一点点缝隙 */
    background-color: rgba(0, 0, 0, 0.06); /* 浅灰色背景 */
    padding: 6px 10px;
    border-radius: 10px; /* 圆角小一点 */
    font-size: 12px;
    color: #888;
    
    /* 文本处理 */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
}
